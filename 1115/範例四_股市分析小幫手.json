{
  "name": "ç¯„ä¾‹ä¸‰_è‚¡å¸‚åˆ†æžå°å¹«æ‰‹",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -368,
        -208
      ],
      "id": "edf80de2-bd29-4204-9760-f3da7602d8a0",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "url": "https://openapi.twse.com.tw/v1/opendata/t187ap04_L",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -160,
        -208
      ],
      "id": "59fa7139-7da5-4fed-96e2-118d8d51f30f",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "content": "## https://openapi.twse.com.tw/#/%E5%85%AC%E5%8F%B8%E6%B2%BB%E7%90%86/get_opendata_t187ap04_L",
        "width": 624
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -416,
        0
      ],
      "typeVersion": 1,
      "id": "2603073e-548c-4a22-8acb-aff2c674c782",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "å‡ºè¡¨æ—¥æœŸ"
            },
            {
              "fieldToAggregate": "ç™¼è¨€æ—¥æœŸ"
            },
            {
              "fieldToAggregate": "ç™¼è¨€æ™‚é–“"
            },
            {
              "fieldToAggregate": "å…¬å¸ä»£è™Ÿ"
            },
            {
              "fieldToAggregate": "å…¬å¸åç¨±"
            },
            {
              "fieldToAggregate": "äº‹å¯¦ç™¼ç”Ÿæ—¥"
            },
            {
              "fieldToAggregate": "èªªæ˜Ž"
            },
            {
              "fieldToAggregate": "ä¸»æ—¨ "
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        0,
        -208
      ],
      "id": "cf6ad97e-5d1c-4527-a8c0-0288cfc64586",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "// Get the single aggregated item\nconst item = $input.first().json;\n\n// Get the ä¸»æ—¨ array\nconst subjects = item['ä¸»æ—¨ '];\n\n// Find indices where ä¸»æ—¨ contains 'è‡ªçµ'\nconst matchingIndices = [];\nsubjects.forEach((subject, index) => {\n  if (subject.includes('è‡ªçµ')) {\n    matchingIndices.push(index);\n  }\n});\n\n// Filter ALL arrays to keep only matching indices\nconst filteredItem = {};\nObject.keys(item).forEach(key => {\n  filteredItem[key] = matchingIndices.map(i => item[key][i]);\n});\n\n// Return as n8n item\nreturn [{ json: filteredItem }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        -208
      ],
      "id": "55e80094-3377-44d3-bac0-f2d86c2d91f4",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// Split the aggregated arrays into individual items\nconst item = $input.first().json;\nconst numItems = item['ä¸»æ—¨ '].length;\n\nconst separateItems = [];\nfor (let i = 0; i < numItems; i++) {\n  const newItem = {};\n  Object.keys(item).forEach(key => {\n    newItem[key] = item[key][i]; // Get single value, not array\n  });\n  separateItems.push({ json: newItem });\n}\n\nreturn separateItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        -208
      ],
      "id": "49b6e066-db4f-40c9-9b09-763855ed9c89",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json[\"å‡ºè¡¨æ—¥æœŸ\"] }}{{ $json[\"ç™¼è¨€æ—¥æœŸ\"] }}{{ $json[\"ç™¼è¨€æ™‚é–“\"] }}{{ $json[\"å…¬å¸ä»£è™Ÿ\"] }}{{ $json[\"å…¬å¸åç¨±\"] }}{{ $json[\"èªªæ˜Ž\"] }}\n",
        "options": {
          "systemMessage": "=ä½ æ˜¯ä¸€ä½è‡ªå‹•åŒ–çš„AIè­‰åˆ¸åˆ†æžå¸«ï¼Œä½ çš„ä»»å‹™æ˜¯ç›£æŽ§å‚³å…¥çš„ã€Œraw data stringã€ï¼Œä¸¦åœ¨ç¬¬ä¸€æ™‚é–“**å‘¼å«å·¥å…· (Tool Call)** ä¾†ç™¼å¸ƒã€Œå€‹è‚¡ç‡Ÿæ”¶å¿«è¨Šã€åˆ°æŒ‡å®šçš„Telegramé »é“ã€‚\n\n**## 1. å¯ç”¨å·¥å…· (Available Tools)**\nä½ æ“æœ‰ä¸€å€‹å·²å®šç¾©çš„å·¥å…·ï¼Œå…¶åŠŸèƒ½ç°½åå¦‚ä¸‹ï¼š\n`send_telegram_message(channel_id: string, message_text: string, parse_mode: string)`\n\n**## 2. æ ¸å¿ƒä»»å‹™èˆ‡åŸ·è¡Œæµç¨‹**\nç•¶ä½ æ”¶åˆ°è¼¸å…¥æ™‚ï¼Œä½ çš„**å”¯ä¸€ä¸”SOPåŒ–çš„ä»»å‹™**æ˜¯ï¼š\n\n1.  **[Parse]** ç«‹å³è§£æžå‚³å…¥çš„ã€Œraw data stringã€ã€‚\n2.  **[Format]** åš´æ ¼æŒ‰ç…§ã€Œåˆ†æžèˆ‡è¼¸å‡ºæ¡†æž¶ã€åœ¨å…§éƒ¨æº–å‚™å¥½ `message_text` çš„å…§å®¹ã€‚\n3.  **[Call Tool]** **ä¸è¦å›žè¦†ä»»ä½•æ–‡å­—**ã€‚ä½ çš„å”¯ä¸€è¼¸å‡ºå¿…é ˆæ˜¯å‘¼å« `send_telegram_message` å·¥å…·ã€‚\n\n**å·¥å…·å‘¼å«åƒæ•¸ (Tool Call Parameters):**\n* `channel_id`: (è«‹å¡«å…¥æ‚¨çš„å¯¦éš›é »é“IDï¼Œä¾‹å¦‚ '@MyStockAlerts' æˆ– '-100123456789')\n* `message_text`: (ä½ æ ¹æ“šä¸‹æ–¹æ¡†æž¶ç”Ÿæˆçš„å®Œæ•´æ ¼å¼åŒ–è¨Šæ¯)\n* `parse_mode`: 'Markdown' (æˆ‘å€‘å°‡ä½¿ç”¨ `**bold**` å’Œ `*` ç¬¦è™Ÿ)\n\n**## 3. è¼¸å…¥æ ¼å¼è©³è§£ (Raw Data String)**\nä½ æ”¶åˆ°çš„è¼¸å…¥æ˜¯ä¸€å€‹ç”±ç³»çµ±ä¸²æŽ¥è€Œæˆçš„å–®ä¸€å­—ä¸²ã€‚\nçµæ§‹: `[å‡ºè¡¨æ—¥æœŸ][ç™¼è¨€æ—¥æœŸ][ç™¼è¨€æ™‚é–“][å…¬å¸ä»£è™Ÿ][å…¬å¸åç¨±][èªªæ˜Ž]`\n\n**è§£æžç­–ç•¥ï¼š**\n* å¾ž `[èªªæ˜Ž]` æ¬„ä½ä¸­çš„ `5.ç™¼ç”Ÿç·£ç”±:` æå–æ‰€æœ‰é—œéµè²¡å‹™æ•¸å­— (æœ¬æœˆç‡Ÿæ”¶ã€MoMã€YoYã€ç´¯è¨ˆç‡Ÿæ”¶)ã€‚\n* `[å…¬å¸ä»£è™Ÿ]` å’Œ `[å…¬å¸åç¨±]` æœƒåœ¨å­—ä¸²é–‹é ­å’Œ `[èªªæ˜Ž]` æ¬„ä½ä¸­å‡ºç¾ã€‚\n\n**## 4. åˆ†æžèˆ‡è¼¸å‡ºæ¡†æž¶ (ç”¨æ–¼ `message_text` åƒæ•¸)**\nä½ å¿…é ˆåš´æ ¼éµå¾ªæ­¤ Markdown æ ¼å¼ï¼š\n\n1.  **æ¨™é¡Œï¼š** æ ¼å¼ç‚º `**ã€è‚¡å¸‚å¿«è¨Šã€‘ [Emoji] [å…¬å¸åç¨±] ([è‚¡ç¥¨ä»£è™Ÿ]) [ç‡Ÿæ”¶ç¸½çµ]**`\n    * `[Emoji]`: `ðŸ“ˆ` (å¼·å‹å¢žé•·), `ðŸ˜` (å–œæ†‚åƒåŠ/æŒå¹³), `ðŸ“‰` (æ˜Žé¡¯è¡°é€€)\n    * `[ç‡Ÿæ”¶ç¸½çµ]`: ä¾‹å¦‚ã€Œ10æœˆç‡Ÿæ”¶å ±å–œã€æˆ–ã€Œ10æœˆç‡Ÿæ”¶æœˆæ¸›å¹´å¢žã€ã€‚\n2.  **ç‡Ÿæ”¶é€Ÿå ± (ðŸ“Š)ï¼š**\n    * æ¢åˆ—å¼å‘ˆç¾ (ä½¿ç”¨ `*` ç¬¦è™Ÿ)ï¼š\n    * `* 10æœˆç‡Ÿæ”¶ï¼š` [é‡‘é¡]\n    * `* æœˆå¢žçŽ‡ (MoM)ï¼š` [æ•¸å­—]% [Emoji]\n    * `* å¹´å¢žçŽ‡ (YoY)ï¼š` [æ•¸å­—]% [Emoji]\n    * `* ç´¯è¨ˆç‡Ÿæ”¶ (YTD)ï¼š` [é‡‘é¡] ([å¹´å¢žçŽ‡]%)\n    * *Emojiç‡ˆè™Ÿï¼š*\n        * `ðŸ“ˆ` (å¢žé•· > +5%)\n        * `ðŸ“‰` (è¡°é€€ < -5%)\n        * `ðŸ˜` (æŒå¹³åœ¨ -5% åˆ° +5% ä¹‹é–“)\n3.  **åˆ†æžå¸«è§€é»ž (ðŸ‘¨â€ðŸ’¼)ï¼š**\n    * (1-2å¥å°ˆæ¥­è§£è®€ï¼Œå„ªå…ˆè©•YoYï¼Œå…¶æ¬¡MoM)\n4.  **æŠ•è³‡å•Ÿç¤º (ðŸ’¡)ï¼š**\n    * (1-2å¥å¾ŒçºŒè§€å¯Ÿé‡é»žï¼Œåƒ…æ ¹æ“šæ•¸æ“š)\n\n---\n**## 5. ç¯„ä¾‹ (ä½ å¿…é ˆå­¸ç¿’æ­¤æ ¼å¼)**\n\n**ç¯„ä¾‹è¼¸å…¥ (Raw String):**\n`114110311411021547353004è±é”ç§‘1.äº‹å¯¦ç™¼ç”Ÿæ—¥:114/11/02\\n2.å…¬å¸åç¨±:è±é”ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸\\n...5.ç™¼ç”Ÿç·£ç”±:\\n è±é”ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸(è‚¡ç¥¨ä»£ç¢¼ï¼š3004)ä»Šæ—¥(2025/11/02)å…¬ä½ˆ2025å¹´10æœˆä»½\\n è‡ªçµåˆä½µç‡Ÿæ”¶ã€‚\\n 2025å¹´10æœˆä»½è‡ªçµåˆä½µç‡Ÿæ”¶ç‚ºæ–°å°å¹£3.61å„„å…ƒï¼Œè¼ƒ2025å¹´9æœˆä»½3.43å„„å…ƒå¢žåŠ 5.25%\\nï¼Œç›¸è¼ƒåŽ»å¹´åŒæœŸçš„2.87å„„å…ƒå¢žåŠ 25.47%ã€‚\\n 2025å¹´ç´¯è¨ˆè‡ªçµåˆä½µç‡Ÿæ”¶ç‚ºæ–°å°å¹£32.74å„„å…ƒï¼Œç›¸è¼ƒåŽ»å¹´åŒæœŸçš„28.57å„„å…ƒå¢žåŠ 14.59%ã€‚...`\n\n**ä½ å”¯ä¸€çš„è¼¸å‡º (å¿…é ˆæ˜¯ Tool Call)ï¼š**\n```function_call\nsend_telegram_message(\n    channel_id=\"[è«‹å¡«å…¥æ‚¨çš„é »é“ID]\",\n    message_text=\"\"\"**ã€è‚¡å¸‚å¿«è¨Šã€‘ ðŸ“ˆ è±é”ç§‘ (3004) 10æœˆç‡Ÿæ”¶å ±å–œ**\n\nðŸ“Š **ç‡Ÿæ”¶é€Ÿå ±ï¼š**\n* 10æœˆç‡Ÿæ”¶ï¼š3.61 å„„å…ƒ\n* æœˆå¢žçŽ‡ (MoM)ï¼š+5.25% ðŸ“ˆ\n* å¹´å¢žçŽ‡ (YoY)ï¼š+25.47% ðŸ“ˆ\n* ç´¯è¨ˆç‡Ÿæ”¶ (YTD)ï¼š32.74 å„„å…ƒ (+14.59% vs. åŽ»å¹´åŒæœŸ)\n\nðŸ‘¨â€ðŸ’¼ **åˆ†æžå¸«è§€é»žï¼š**\nè±é”ç§‘å±•ç¾äº†ã€Œé›™å¢žé•·ã€çš„å¼·å‹æ…‹å‹¢ï¼YoY å¤§å¹…å¢žé•·è¶…éŽ25%ï¼Œé¡¯ç¤ºé•·æœŸéœ€æ±‚éžå¸¸ç©©å¥ï¼›MoM äº¦ä¿æŒæ­£å‘å¢žé•·ï¼ŒçŸ­æœŸå‹•èƒ½ä¸æ¸›ã€‚\n\nðŸ’¡ **æŠ•è³‡å•Ÿç¤ºï¼š**\nç´¯è¨ˆç‡Ÿæ”¶å¹´å¢žçŽ‡è¿‘15%ï¼ŒåŸºæœ¬é¢ç©©å›ºã€‚é€™å¯èƒ½åæ˜ äº†èˆªå¤ªæˆ–é«˜éšŽæ‰£ä»¶å¸‚å ´çš„éœ€æ±‚æŒçºŒå¼·å‹ï¼Œç‡Ÿé‹å‰æ™¯çœ‹å¥½ã€‚\"\"\",\n    parse_mode=\"Markdown\"\n)"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        592,
        -208
      ],
      "id": "3df4deb7-39ce-4a30-84bc-b5e36a8e077a",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        528,
        16
      ],
      "id": "dddaf9ba-29dc-454a-90ff-85385221bd95",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "L0n5BwILDXBepctt",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "1155953917",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTool",
      "typeVersion": 1.2,
      "position": [
        768,
        0
      ],
      "id": "45cd3c13-16df-4def-8edc-1f42628bdce7",
      "name": "Send a text message in Telegram",
      "webhookId": "0878489f-7225-4e07-b5b2-d87657d8d5d2",
      "credentials": {
        "telegramApi": {
          "id": "VoN9Qg4kLRxxkCas",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message in Telegram": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f854a621-eb76-4cb1-b531-22b834d780fc",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a51bd188aa10025f8b4f8b60fd29b53879528fa7cce0b569b9cc2640cf6d5c9d"
  },
  "id": "eUXuwpWAJah1sBRS",
  "tags": []
}